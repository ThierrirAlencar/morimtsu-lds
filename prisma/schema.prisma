
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

enum Gender {
  male 
  female
  other
}

enum Rank {
  BRANCA
  CINZA_BRANCA
  CINZA
  CINZA_PRETA
  AMARELA_BRANCA
  AMARELA
  AMARELA_PRETA
  LARANJA_BRANCA
  LARANJA
  LARANJA_PRETA
  VERDE_BRANCA
  VERDE
  VERDE_PRETA
  AZUL
  ROXA
  MARROM
  PRETA
  VERMELHA

  // Non Colorfull RANKS
  KIDS
  JUVENIL
}


model User {
  id String @id @default(uuid())

  //true data
  password String
  role Role @default(USER)

  //prime keys
  name String @unique 
  email String @unique
  
  //Foreign keys
  users UserClasses[]
  frequency frequency[]
  studentData StudentForm?
  promotionRegistry promotion_registry[]
}

model Class {
  id String @id @default(cuid())
  
  //True data
  name String @unique
  description String?

  icon_url String? 

  startTime DateTime? @db.Time  // apenas hor√°rio (sem data)
  endTime   DateTime? @db.Time

  maxAge Int @default(99)
  minAge Int @default(0)
  
  //Foreign keys
  classes UserClasses[]
  students StudentClasses[]
  frequency frequency[]
  events events[]
} 

model student {
  id String @id @default(uuid())
  
  //True data
  name String
  nickname String?
  Contact String 
  birthDate DateTime
  gender Gender 
  
  //Prime keys
  email String @unique
  CPF String @unique
  
  //Parent contact
  parentName String?
  parentContact String?

  //Extra
  createdAt DateTime @default(now())


  //Relations
  classes StudentClasses[]
  formData StudentForm?
  frequency frequency[]
  promotionRegistry promotion_registry[]
}

model StudentForm{
  id String @id @default(cuid())

  //True data
  Rating Int @default(0)
  Presence Int @default(0)
  Comments String?
  Rank Rank @default(BRANCA)
  IFCE_student_registration String?
  Health_issues String?
  Medication_usage String?
  Allergies String?

  //Foreign Keys
  student student @relation(fields: [studentId], references: [id])
  studentId String @unique

  user User? @relation(fields: [userId], references: [id])
  userId String? @unique
}

model frequency{
  id String @id @default(cuid())
  
  Date DateTime @default(now())

  coach_id String
  Coach User @relation(fields: [coach_id], references: [id])

  student_id String
  Student student @relation(fields: [student_id], references: [id])

  class_id String
  Class Class @relation(fields: [class_id], references: [id])
  @@map("Frequency")
}

model promotion_config{
  id String @id @default(cuid())

  name String @unique

  module String @default("app")
  ref_rank Rank

  needed_frequency Int @default(1)
}

model promotion_registry{
  id String @id @default(cuid())

  date DateTime @default(now())

  student_id String
  Student student @relation(fields: [student_id], references: [id])

  coach_id String
  coach User @relation(fields: [coach_id], references: [id])

  from_rank Rank
  to_rank Rank
}
model events{
  id String @id @default(cuid())

  title String

  event_date DateTime

  createdAt DateTime @default(now())

  class_id String
  Class Class @relation(fields: [class_id], references: [id])
}

//Relational classes (FK Classes to many to many relations)

model UserClasses {
  user    User   @relation(fields: [userId], references: [id])
  userId  String
  class   Class  @relation(fields: [classId], references: [id])
  classId String

  @@id([userId, classId])
}

model StudentClasses {
  student    student   @relation(fields: [studentId], references: [id])
  studentId  String
  class      Class     @relation(fields: [classId], references: [id])
  classId    String

  @@id([studentId, classId])
}

